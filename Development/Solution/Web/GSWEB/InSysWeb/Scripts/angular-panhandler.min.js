(function(){"use strict";function t(e){return e[0].scrollWidth}function n(e){return e[0].scrollHeight}function r(e){if(typeof e.width==="function"){return e.offsetParent().width()}else{return e[0].offsetWidth}}function i(e){if(typeof e.height==="function"){return e.offsetParent().height()}else{return e[0].offsetHeight}}function s(e){var t=0,n,r,i;if(e.length===0)return t;for(n=0,i=e.length;n<i;n++){r=e.charCodeAt(n);t=(t<<5)-t+r;t|=0}return t}function u(){var e=document.createElement("p"),t,n={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(e,null);for(var r in n){if(e.style[r]!==undefined){e.style[r]="translate3d(1px,1px,1px)";t=window.getComputedStyle(e).getPropertyValue(n[r])}}document.body.removeChild(e);return t!==undefined&&t.length>0&&t!=="none"}angular.module("panhandler",[]).directive("panhandler",["$document",function(t){return{scope:{preventPan:"@preventPan"},link:function(r,i,s){setTimeout(function(){new e(i,s,r,t)})}}}]);var e=function(e,t,n,r){this.$el=e;this.contentWidth=t.contentWidth;this.contentHeight=t.contentHeight;this.curr=[];this.origin=[];this.startPos=[];this.pos=[0,0];this.touch="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch;this.has3d=u();this.overEvent="mouseover";this.downEvent=this.touch?"touchstart":"mousedown";this.upEvent=this.touch?"touchend":"mouseup";this.moveEvent=this.touch?"touchmove":"mousemove";this.noTouch=o("user-select","none");this.$scope=n;this.$document=r;this.startBind=angular.bind(this,this.startDrag);this.endBind=angular.bind(this,this.endDrag);this.updateBind=angular.bind(this,this.updateDrag);this.mouseOutBind=angular.bind(this,this.mouseOut);this.mouseOverBind=angular.bind(this,this.mouseOver);this.init()};e.prototype={init:function(){this.$el.css("overflow","hidden");this.draggable=angular.element('<div class="panhandler-wrap"></div>');this.draggable.css(this.noTouch);if(this.contentWidth){this.draggable.css("width",this.contentWidth)}this.grabCursor();angular.forEach(this.$el.contents(),angular.bind(this,function(e){this.draggable.append(e)}));this.draggable.append('<div style="clear:both;"></div>');this.$el.append(this.draggable);this.makeInteractive()},tick:function(){if(this.origin.length&&this.dirty){this.updatePosition();this.dirty=false}this.loop=window.requestAnimationFrame(angular.bind(this,this.tick))},updatePosition:function(){var e=this.clampX(this.startPos[0]+(this.curr[0]-this.origin[0]));var t=this.clampY(this.startPos[1]+(this.curr[1]-this.origin[1]));this.pos=[e,t];if(this.has3d){var n=o("transform","translate3d("+e+"px,"+t+"px, 0)");this.draggable.css(n)}else{this.draggable.css("margin-left",e+"px");this.draggable.css("margin-top",t+"px")}},clampX:function(e){return Math.max(Math.min(0,e),this.minX)},clampY:function(e){return Math.max(Math.min(0,e),this.minY)},cacheBounds:function(){this.contentDimensions=[t(this.draggable),n(this.draggable)];this.viewDimensions=[r(this.$el),i(this.$el)];this.minX=Math.min(this.viewDimensions[0]-this.contentDimensions[0],0);this.minY=Math.min(this.viewDimensions[1]-this.contentDimensions[1],0)},isPrevented:function(){return this.$scope.preventPan===true||this.$scope.preventPan==="true"},startDrag:function(e){if(this.isPrevented()){return false}this.origin=this.positionFromEvent(e);this.startPos=[this.pos[0],this.pos[1]];this.cacheBounds();this.grabbingCursor();this.$document.on(this.moveEvent,this.updateBind);this.$document.on(this.upEvent,this.endBind);this.$el.on("mouseout",this.mouseOutBind);this.updateDrag(e);this.tick()},updateDrag:function(e){var t=this.positionFromEvent(e);if(t[0]!==this.curr[0]||t[1]!==this.curr[1]){this.dirty=true;this.curr=[t[0],t[1]]}},endDrag:function(){this.origin=[];this.curr=[];this.grabCursor();this.$document.off(this.moveEvent,this.updateBind);this.$document.off(this.upEvent,this.endBind);this.$el.off("mouseout",this.mouseOutBind);window.cancelAnimationFrame(this.loop)},positionFromEvent:function(e){return[e.pageX||e.originalEvent.touches[0].pageX,e.pageY||e.originalEvent.touches[0].pageY]},makeInteractive:function(){this.draggable.on(this.downEvent,this.startBind);if(!this.touch){this.draggable.on(this.overEvent,this.mouseOverBind)}this.$el.on("$destroy",this.destroy)},mouseOver:function(e){this.grabCursor()},mouseOut:function(e){var t=e.target;var n=t.querySelector&&t.querySelector(".panhandler-wrap");if(n||e.toElement===undefined||e.toElement.tagName==="HTML"){this.endDrag()}},destroy:function(){if(this.loop){window.cancelAnimationFrame(this.loop)}this.$document.off(this.upEvent,this.endBind)},grabCursor:function(){var e=navigator.userAgent.match(/WebKit/);var t=navigator.userAgent.match(/Gecko/);var n="move";if(this.isPrevented()){n=""}else if(e){n="-webkit-grab"}else if(t){n="-moz-grab"}this.draggable.css("cursor",n)},grabbingCursor:function(){var e=navigator.userAgent.match(/WebKit/);var t=navigator.userAgent.match(/Gecko/);if(e){this.draggable.css("cursor","-webkit-grabbing")}else if(t){this.draggable.css("cursor","-moz-grabbing")}else{this.draggable.css("cursor","move")}}};var o=function(){var e=["-webkit-","-moz-","-ms-",""];return function(n,r){var i={};angular.forEach(e,function(e){i[e+n]=r});return i}}()})()