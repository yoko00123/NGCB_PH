"use strict";define(["app"],function(a){var b=function(m,k,f,v,n,i,p,o,h,e,j){if(k.error!==undefined){i.add(k.error,"danger",5000)}m.Sum=function(q,g){return v.Sum(q,g)};m.Max=function(q,g){return v.Max(q,g)};m.Min=function(q,g){return v.Min(q,g)};m.Ave=function(q,g){return v.Ave(q,g)};m.goPrevious=function(){window.history.back()};m.Session=o.data;m.mID=1070;m.rID=n.params.ID_1070;m.Master=k.Master;m.Detail=k.Detail;m.dropdown_source=k.dropdown_source;m.rdb_source=k.rdb_source;m.autocomplete_source=k.autocomplete_source;m.gridOptions={4085:{data:"Detail[4085]",multiSelect:false,virtualizationThreshold:50,columnDefs:[{field:"Name",width:"*",displayName:"File Name",cellTemplate:"<div class='ngCellText'><span class='control-label' ng-bind-html='row.entity.Name | trustedHTML'></span></div>"},{field:"ID_Employee",width:"*",displayName:"Attached by",cellTemplate:"<div ng-form name='x' ng-class=\"{ 'has-error' : x.ID_Employee.$invalid && mainform.$submitted }\" ><select name='ID_Employee' ng-options='item.ID as item.Name for item in dropdown_source[4349]'  required  disabled  class='form-control' ng-model='row.entity.ID_Employee'><option value>- Select -</option></select>"},{field:"AttachedDate",width:"*",displayName:"Date Attached",headerCellTemplate:p.get("nggrid/headerCellTemplateDate.html"),cellTemplate:"<div ng-form name='x' ng-class=\"{ 'has-error' : x.AttachedDate.$invalid && mainform.$submitted }\" ><div class='input-group'><input type='text' name='AttachedDate' date-format='MM/dd/yyyy' placeholder='AttachedDate'  required  disabled bs-datepicker data-container='body' date-to-iso class='form-control' ng-model='row.entity.AttachedDate'/><span class='input-group-addon'><i class='fa fa-calendar'></i></span></div></div>"},{field:"AttachedFileName_GUID",width:"*",displayName:"AttachedFileName_GUID",visible:false,cellTemplate:"<div class='ngCellText'><span class='control-label' ng-bind-html='row.entity.AttachedFileName_GUID | trustedHTML'></span></div>"},{field:"AttachedFileName",width:"*",displayName:"File",visible:false,cellTemplate:"<div class='smart-form input-group' style='width:100%' ng-form name='x' ng-class=\"{ 'has-error' : x.AttachedFileName.$invalid && mainform.$submitted }\" ><label for='file' class='input input-file'><div class='button'><input type='file' name='AttachedFileName'  required file-input ng-file-select='onFileSelect($files,4085,\"AttachedFileName\",row.rowIndex)'ng-model='row.entity.AttachedFileName'/>Browse</div><input type='text' ng-model='row.entity.AttachedFileName' placeholder='Select files...' readonly></label><span class='input-group-addon' ng-if='row.entity.ID > 0 && row.entity.AttachedFileName !== null' download-file='{{row.entity.AttachedFileName_GUID}}' filename='{{row.entity.AttachedFileName}}'><i class='fa fa-download'></i></span></div>"},{field:"ID",width:100,displayName:"Remove?",cellTemplate:"<div class='ngCellText'><span><a class='row-delete' ng-click='removeRow(4085,row)'  ><i class='fa fa-times'></i></a></span></div>"},],init:function(q,g){setTimeout(function(){g.gridOptions[4085].$gridServices.DomUtilityService.RebuildGrid(g.gridOptions[4085].$gridScope,g.gridOptions[4085].ngGrid)},500)}},2067:{data:"Detail[2067]",multiSelect:false,virtualizationThreshold:50,columnDefs:[{field:"ID_ApprovalLevel",width:"100",displayName:"Approval Level",cellTemplate:"<div ng-form name='x' ng-class=\"{ 'has-error' : x.ID_ApprovalLevel.$invalid && mainform.$submitted }\" ><select name='ID_ApprovalLevel' ng-options='item.ID as item.Name for item in dropdown_source[9219]'  required  ng-disabled='row.entity.IsCanOverride == 0 || Master.ID_FilingStatus != 1'  class='form-control' ng-model='row.entity.ID_ApprovalLevel'><option value>- Select -</option></select>"},{field:"ID_EmployeeApprover1",width:"*",displayName:"Approver",cellTemplate:"<div ng-form name='x' ng-class=\"{ 'has-error' : x.ID_EmployeeApprover1.$invalid && mainform.$submitted }\" ><input type='text' name='EmployeeApprover1' placeholder='Approver' ng-change=\"clearAutoComplete(row.entity,'ID_EmployeeApprover1')\"  ng-disabled='row.entity.IsCanOverride == 0 || Master.ID_FilingStatus != 1' typeahead-append-to-body='true' typeahead-on-select=\"setID(row.entity,'ID_EmployeeApprover1',$item)\" typeahead='item as item.Name for item in autocomplete_source[2189] | filter:$viewValue | limitTo:10' class='form-control' ng-model='row.entity.EmployeeApprover1'/><input type='hidden' name='ID_EmployeeApprover1'  required class='form-control' ng-model='row.entity.ID_EmployeeApprover1'/></div>"},{field:"ID_EmployeeApprover2",width:"*",displayName:"Alternate Approver 1",cellTemplate:"<div ng-form name='x' ><input type='text' name='EmployeeApprover2' placeholder='Alternate Approver 1' ng-change=\"clearAutoComplete(row.entity,'ID_EmployeeApprover2')\"  ng-disabled='row.entity.IsCanOverride == 0 || Master.ID_FilingStatus != 1' typeahead-append-to-body='true' typeahead-on-select=\"setID(row.entity,'ID_EmployeeApprover2',$item)\" typeahead='item as item.Name for item in autocomplete_source[2190] | filter:$viewValue | limitTo:10' class='form-control' ng-model='row.entity.EmployeeApprover2'/><input type='hidden' name='ID_EmployeeApprover2' class='form-control' ng-model='row.entity.ID_EmployeeApprover2'/></div>"},{field:"ID_EmployeeApprover3",width:"*",displayName:"Alternate Approver 2",cellTemplate:"<div ng-form name='x' ><input type='text' name='EmployeeApprover3' placeholder='Alternate Approver 2' ng-change=\"clearAutoComplete(row.entity,'ID_EmployeeApprover3')\"  ng-disabled='row.entity.IsCanOverride == 0 || Master.ID_FilingStatus != 1' typeahead-append-to-body='true' typeahead-on-select=\"setID(row.entity,'ID_EmployeeApprover3',$item)\" typeahead='item as item.Name for item in autocomplete_source[2191] | filter:$viewValue | limitTo:10' class='form-control' ng-model='row.entity.EmployeeApprover3'/><input type='hidden' name='ID_EmployeeApprover3' class='form-control' ng-model='row.entity.ID_EmployeeApprover3'/></div>"},{field:"IsCanOverride",width:"*",displayName:"IsCanOverride",visible:false,cellTemplate:"<input type='hidden' name='IsCanOverride' class='form-control' ng-model='row.entity.IsCanOverride'/>"},{field:"ID",width:20,displayName:"",cellTemplate:"<div ng-if='row.entity.IsCanOverride == 1' class='ngCellText'><span><a class='row-delete' ng-click='removeRow(2067,row)'  ><i class='fa fa-times'></i></a></span></div>"},],init:function(q,g){setTimeout(function(){g.gridOptions[2067].$gridServices.DomUtilityService.RebuildGrid(g.gridOptions[2067].$gridScope,g.gridOptions[2067].ngGrid)},500)}},4097:{data:"Detail[4097]",multiSelect:false,virtualizationThreshold:50,columnDefs:[{field:"ApprovalLevel",width:"*",displayName:"Level",cellTemplate:"<div class='ngCellText' ng-class='col.colIndex()'><span class='control-label' ng-bind-html='row.entity.ApprovalLevel | trustedHTML'></span></div>"},{field:"EmployeeApprover1",width:"*",displayName:"Approver 1",cellTemplate:"<div class='ngCellText' ng-class='col.colIndex()'><span class='control-label' ng-bind-html='row.entity.EmployeeApprover1 | trustedHTML'></span></div>"},{field:"EmployeeApprover2",width:"*",displayName:"Alternate Approver 1",cellTemplate:"<div class='ngCellText' ng-class='col.colIndex()'><span class='control-label' ng-bind-html='row.entity.EmployeeApprover2 | trustedHTML'></span></div>"},{field:"EmployeeApprover3",width:"*",displayName:"Alternate Approver 2",cellTemplate:"<div class='ngCellText' ng-class='col.colIndex()'><span class='control-label' ng-bind-html='row.entity.EmployeeApprover3 | trustedHTML'></span></div>"},{field:"FilingStatus",width:"*",displayName:"Status",cellTemplate:"<div class='ngCellText' ng-class='col.colIndex()'><span class='control-label' ng-bind-html='row.entity.FilingStatus | trustedHTML'></span></div>"},{field:"Comment",width:"*",displayName:"Notes/Remarks"},{field:"DateValidated",width:"*",displayName:"Action Date",headerCellTemplate:p.get("nggrid/headerCellTemplateDate.html"),cellFilter:"date:'MM/dd/yyyy'"},],init:function(q,g){setTimeout(function(){g.gridOptions[4097].$gridServices.DomUtilityService.RebuildGrid(g.gridOptions[4097].$gridScope,g.gridOptions[4097].ngGrid)},500)}},};m.removeRow=function(q,r){var g=m.Detail[q].indexOf(r.entity);if(r.entity.ID==0){m.Detail[q].splice(g,1)}else{f.GridDelete(q,r.entity.ID).then(function(s){m.Detail[q].splice(g,1)})}};m.setID=function(q,r,g){q[r.substring(3)]=g.Name;q[r]=g.ID};m.clearAutoComplete=function(g,q){g[q]=null};m.getAutoCompleteItems=function(q,g,r){return f.getAutoCompleteItems(q,g,r).then(function(s){return s.items})};m.tabs=[];m.tabs.activeTab=0;m.loadedTab=[];m.loadTab=function(g){f.loadTab(g,m.rID).then(function(q){m.Detail[g]=q.data})};m.selectedFiles=[];m.onFileSelect=function(g,s,u,r){for(var q=0;q<m.selectedFiles.length;q++){if(m.selectedFiles[q].mID==s&&m.selectedFiles[q].name==u&&m.selectedFiles[q].idx==r){m.selectedFiles.splice(q,1);break}}m.selectedFiles.push({file:g[0],mID:s,name:u,idx:r})};m.getPositionDetails=function(){f.getPositionDetails(m.Master.ID_Designation).then(function(q){m.Master.Company=q.data.Company;m.Master.CompanyGroup=q.data.CompanyGroup;m.Master.Department=q.data.Department;m.Master.ReportsTo=q.data.ReportsTo;m.Master.JobClass=q.data.JobClass;m.Master.Designation=q.data.Name;m.Master.Budgeted=q.data.Budgeted;m.Master.Actual=q.data.Actual;m.Master.OpenVacancy=q.data.OpenVacancy;m.Master.ActiveVacancy=q.data.ActiveVacancy;m.dropdown_source[4548]=q.empresigned;console.log(q);var g="";if(q.data.WorkLocation!=null){g+="<p>Work Location: "+q.data.WorkLocation+"<p>"}if(q.data.WorkExperiences!=null){g+="<p>Work Experience: "+q.data.WorkExperiences+"<p>"}if(q.data.EducationDegree!=null){g+="<p>Educational Attainment: "+q.data.EducationDegree+"<p>"}if(q.data.Licenses!=null){g+="<p>Licenses: "+q.data.Licenses+"<p>"}if(q.data.OtherQualifications!=null){g+="<p>Other Qualifications: "+q.data.OtherQualifications+"<p>"}if(g.length==0){g=null}m.Master.Qualifications=g;m.Master.KeyResults=q.data.JobSummary})};m.$watch("Master.ID_MRFNatureOfRequest",function(q,r){if((r==3||r==4)&&m.Master.SBAR!=null&&(q!=3&&q!=4)){var g=h.confirm(undefined,"Attached SBAR will be removed. Continue?",{size:"sm"});g.result.then(function(s){m.Master.SBAR=null;m.Master.SBAR_GUID=null},function(s){m.Master.ID_MRFNatureOfRequest=r})}});m.toggleUpload=function(){document.getElementById("uploadFile").click()};m.AttachFiles=function(r,y){var s=r.length;var q=0;var w=4085;var x="AttachedFileName";var g=[];var u=m.Detail[w].length;for(q=0;q<s;q++){g.push(f.AddNewRow(w))}j.all(g).then(function(A){for(var B=0;B<A.length;B++){A[B].data.AttachedFileName=r[B].name;for(var z=0;z<m.selectedFiles.length;z++){if(m.selectedFiles[z].mID==w&&m.selectedFiles[z].name==x&&m.selectedFiles[z].idx==u){m.selectedFiles.splice(z,1);break}}m.selectedFiles.push({file:r[B],mID:w,name:x,idx:u});m.Detail[w].push(A[B].data);u+=1}})};m.DownloadMRFFile=function(q,g){DownloadFile("../Contents/Attachments/MRF/"+q.AttachedFileName)};m.removeMRFAttachment=function(q,r,g){if(r.ID==0){m.Detail[q].splice(g,1)}else{f.GridDelete(q,r.ID).then(function(s){m.Detail[q].splice(g,1)})}};m.loadModal=function(r,g){var q=h.create("Dialogs/c1070Dialog.html","c1070Dialog",{ID:r,Action:g},{size:"md",keyboard:true,backdrop:true,windowClass:"my-class"});q.result.then(function(w){var s="ID_"+m.mID;var u={};u[s]=m.rID;n.go(n.current,u,{reload:true,inherit:false,notify:true})},function(){})};m.viewComment=function(r,q){var g=h.create("Dialogs/c4097Dialog.html","c4097Dialog",{row:r},{size:"md",keyboard:true,backdrop:true,windowClass:"my-class"});g.result.then(function(s){m.Detail[4097][q].Comment=s.Comment},function(){})};m.CancelApplication=function(){f.CancelApplication(m.Master.ID,2).then(function(g){m.Master.ID_FilingStatus=g.statusid;m.Master.FilingStatus=g.statusname})};m.OnHoldApplication=function(){f.OnHoldApplication(m.Master.ID,2).then(function(g){n.go(n.current,n.params,{reload:true,inherit:false,notify:true})})};m.removeLiRow=function(r,q,g){if(g==0){m.Detail[r].splice(q,1)}else{f.GridDelete(r,g).then(function(s){m.Detail[r].splice(q,1)})}};e.check(m);var l=0;m.NatureOfRequest=function(){if(m.Master.ID_MRFNatureOfRequest==2){l=m.Master.RequestHeadCount;m.Master.RequestHeadCount=1}else{m.Master.RequestHeadCount=l}};m.AddNewApprover=function(){if(m.Master.ID_Designation==null){i.add("Please specify position title first.","warning",5000)}else{f.AddMRFApprovers(2067,m.Master.ID_Designation,m.Master.ID).then(function(g){g.data.ID_HRMSMatrixModule=2;g.data.RefID=m.Master.ID;g.data.IsCanOverride=1;if(m.Detail[2067].length==0){m.Detail[2067].push(g.required)}m.Detail[2067].push(g.data)})}};m.CascadingDropdown=function(r,g,s,q){if(g==1176){m.Master.Company=null;m.Master.CompanyGroup=null;m.Master.Department=null;m.Master.ReportsTo=null;m.Master.JobClass=null;m.Master.Designation=null;m.Master.Budgeted=null;m.Master.Actual=null;m.Master.OpenVacancy=null;m.Master.ActiveVacancy=null;m.Master.ID_Designation=null}f.CascadingDropdown(r,g,s).then(function(x){var u=q.split(",");for(var w=0;w<u.length;w++){m.dropdown_source[u[w]]=x.data[u[w]]}})};if(m.Master.ID_Designation==null){m.CascadingDropdown(1070,1176,m.Master.ID_CostCenter,"1173")}else{var t=m.Master.ID_Designation;m.CascadingDropdown(1070,1176,m.Master.ID_CostCenter,"1173");m.Master.ID_Designation=t;m.getPositionDetails()}m.isValidApprovers=function(){var g=null;var q=false;var s=0;for(var r=0;r<m.Detail[2067].length;r++){var u=m.Detail[2067][r];if(u.ID_ApprovalLevel==null){q=true}if(g==null||u.ID_ApprovalLevel>g.ID_ApprovalLevel){g=u}}if(g!=null&&g.ID_ApprovalLevel!=null){s=g.ID_ApprovalLevel}return q==false&&s==m.Detail[2067].length};m.canEdit=function(){return(m.Master.ID_FilingStatus==1||m.Master.ID_FilingStatus==5)};m.isRequestor=function(){return(m.Master.ID_Employee==m.Session.ID_Employee)};m.clearApprovers=function(){console.log(m.Detail[2067])}};a.register.controller("c1070",["$scope","resources","dataService","utilService","$state","growlNotifications","$templateCache","Session","dialogs","ckFormPristine","$q",b]);var c=function(j,e,i,f,h){j.Data={Comment:null,ID:f.ID,Action:f.Action};j.cancel=function(){i.dismiss("Canceled")};j.save=function(){e.ApproveModule(j.Data).then(function(g){h.add(g.message,"info",5000);i.close()})}};a.register.controller("c1070Dialog",["$scope","dataService","$modalInstance","data","growlNotifications",c]);var d=function(j,e,i,f,h){j.Data={Comment:f.row.Comment};j.cancel=function(){i.dismiss("Canceled")};j.save=function(){e.SaveComment(f.row.ID,j.Data.Comment,4097).then(function(g){h.add(g.message,"info",5000);i.close({Comment:j.Data.Comment})})}};a.register.controller("c4097Dialog",["$scope","dataService","$modalInstance","data","growlNotifications",d])});