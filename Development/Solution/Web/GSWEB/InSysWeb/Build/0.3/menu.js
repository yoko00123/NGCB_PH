"use strict";define(["app"],function(a){var d=function(m,f,q,j,n,l,o,i,k,e){l.employee={};m.notification={};m.notification.Msg=[];m.notification.Cnt=0;m.notification.NewMsg=[];m.notification.fData="";m.LastID=0;var p=n.get();f.loadMenus().then(function(h){m.menus=h.menus;m.employee=l.employee=h.employee;var r=h.employee.CompanyLogoSize;m.width=r.split(";")[0];m.height=r.split(";")[1];m.EnableNotification=h.EnableNotification;m.TotalCnt=10;if(Boolean(m.EnableNotification)){f.getNotification().poll(m.TotalCnt,0).then(function(t){m.notification.Msg=t.Msg;m.notification.Cnt=t.CntRecord;angular.forEach(m.notification.Msg,function(v,u){angular.forEach(v,function(x,w){if(w=="ID"){if(m.LastID<x){m.LastID=x}}})})});var g=function(){m.$apply(function(){f.getNotification().poll(m.TotalCnt,m.LastID).then(function(t){if(t.Msg!=undefined){m.notification.Msg=t.Msg;$("#notificationLoading").html('See more notification <i class="fa fa-angle-right"></i>');m.notification.Cnt=t.CntRecord;m.notification.NewMsg=t.NewMsg;m.notification.fData=t.fData;m.notifyMessage(m.notification.NewMsg);angular.forEach(m.notification.Msg,function(v,u){angular.forEach(v,function(x,w){if(w=="ID"){if(m.LastID<x){m.LastID=x}}})})}})})};var s;clearInterval(s);s=setInterval(g,5000)}});m.AddMoreNotification=function(g){m.TotalCnt=m.TotalCnt+10;$("#notificationLoading").html('<img src="Resources/System/notificationLoading.gif" />')};m.viewNotification=function(h){var g=i.create("Dialogs/notification.html","cNotification",{data:h},{size:"md",keyboard:true,backdrop:true,windowClass:"my-class"});m.UpdateReadNotification(h)};m.UpdateReadNotification=function(g){if(!g.IsView){f.updateNotification(g.ID).then(function(h){if(h.message!=""){j.add("There was an error updating your notification","danger",5000)}else{g.IsView=h.IsView;m.notification.Cnt=m.notification.Cnt-1}})}};_.groupByMulti=function(r,u,h){if(!u.length){return r}var g=_.groupBy(r,u[0],h),t=u.slice(1);for(var s in g){g[s]=_.groupByMulti(g[s],t,h)}return g};m.notifyMessage=function(g){angular.forEach(g,function(r,h){angular.forEach(r,function(u,s){var t=p.filter(function(v){return v.mID==u.ID_Parent});angular.forEach(u.Employee,function(x,v){var w="<a href='#/"+t[0].stateName.replace(/ /g,"-")+"/"+x.fData+"'>You have "+String(x.CNT)+" "+s+" from "+x.Sender+"</a>";j.add(w,"info",5000)})})})};m.replaceTimeSpan=function(g){if(g.WeekSpan>8){return moment(g.DateTimeCreated).format("MM/DD/YYYY hh:mm A")}else{if(g.DaySpan>7){return"About "+String(g.WeekSpan)+" week(s) ago..."}else{if(g.HourSpan>24){return"About "+String(g.DaySpan)+" day(s) ago..."}else{if(g.MinuteSpan>60){return"About "+String(g.HourSpan)+" hour(s) ago..."}else{return"About "+String(g.MinuteSpan)+" minute(s) ago..."}}}}};m.Session=o.data;m.PublishWebsite=function(){f.PublishWebsite().then(function(g){j.add(g.message,"info",5000)})};m.ClearMenu=function(){f.ClearMenu().then(function(g){j.add(g.message,"info",5000);n.reload()})};m.MinifyScripts=function(){f.MinifyScripts().then(function(g){j.add(g.message,"info",5000);n.reload()})};m.Run=function(){var g=i.create("Dialogs/RunScript.html","ScriptController",{},{size:"xl",keyboard:true,backdrop:"static"})};m.ShowFileExplorer=function(){i.create("Dialogs/FileExplorer.html","FileExplorerController",{},{size:"xl",keyboard:true,backdrop:"static"})};m.ShowSystemDashboard=function(){i.create("Dialogs/SystemDashboard.html","SystemDashboardController",{},{size:"xl",keyboard:true,backdrop:"static"})};k.bindTo(m).add({combo:"alt+shift+r+s",callback:function(){if(o.data.ID_User==1){m.Run()}}}).add({combo:"alt+shift+f+e",callback:function(){if(o.data.ID_User==1){m.ShowFileExplorer()}}}).add({combo:"alt+l",callback:function(){window.location.href="Logout.aspx"}}).add({combo:"alt+shift+s+d",callback:function(){if(o.data.ID_User==1){m.ShowSystemDashboard()}}});m.loadCalendar=function(){var g=i.create("Dialogs/calendar.html","cCalendar",{},{size:"xl",keyboard:true,backdrop:true,windowClass:"my-class"})}};a.controller("menuCtrl",["$scope","dataService","utilService","growlNotifications","$state","$rootScope","Session","dialogs","hotkeys","$filter",d]);var b=function(k,e,g,l){k.Master={};k.calendarView="month";k.calendarDay=new Date();k.events=[];k.mainEvent=[];k.Master.calendarMonth=moment(k.calendarDay).month()+1;k.Master.calendarYear=moment(k.calendarDay).year();var n=k.Master.calendarYear,h=k.Master.calendarMonth-1;var m=moment([n,h]).toDate();j(m,moment(m).endOf("month").toDate());k.gotoMonth=function(){m=moment([k.Master.calendarYear,k.Master.calendarMonth-1]).toDate();j(m,moment(m).endOf("month").toDate());k.Master.calendarControl.goToMonth(k.Master.calendarMonth)};k.gotoYear=function(){m=moment([k.Master.calendarYear,k.Master.calendarMonth-1]).toDate();j(m,moment(m).endOf("month").toDate());k.Master.calendarControl.goToYear(k.Master.calendarYear)};k.prev=function(){k.Master.calendarControl.prev();j(k.Master.calendarControl.getFirstDayOfMonth(),k.Master.calendarControl.getLastDayOfMonth());k.Master.calendarMonth=moment(k.Master.calendarControl.getFirstDayOfMonth()).month()+1;k.Master.calendarYear=moment(k.Master.calendarControl.getFirstDayOfMonth()).year()};k.next=function(){k.Master.calendarControl.next();j(k.Master.calendarControl.getFirstDayOfMonth(),k.Master.calendarControl.getLastDayOfMonth());k.Master.calendarMonth=moment(k.Master.calendarControl.getFirstDayOfMonth()).month()+1;k.Master.calendarYear=moment(k.Master.calendarControl.getFirstDayOfMonth()).year()};k.setCalendarToToday=function(){k.Master.calendarControl.setCalendarToToday();j(k.Master.calendarControl.getFirstDayOfMonth(),k.Master.calendarControl.getLastDayOfMonth());k.Master.calendarMonth=moment(k.Master.calendarControl.getFirstDayOfMonth()).month()+1;k.Master.calendarYear=moment(k.Master.calendarControl.getFirstDayOfMonth()).year()};function j(o,i){e.GetCalendarSource(o,i).then(function(r){k.events=r.data;k.mainEvent=[];var q=[];var p=[];$.each(r.data,function(s,t){if($.inArray(t.starts_at,p)===-1){p.push(t.starts_at);q.push(t)}});$.each(q,function(t,u){var s=[];$.each(r.data.filter(function(v){return v.starts_at==u.starts_at&&v.DayType=="LH"}),function(v,w){s.push(w)});if(s.length>0){$.each(s,function(v,w){k.mainEvent.push(w)})}else{$.each(r.data.filter(function(v){return v.starts_at==u.starts_at&&v.DayType=="SH"}),function(v,w){s.push(w)});if(s.length>0){$.each(s,function(v,w){k.mainEvent.push(w)})}else{$.each(r.data.filter(function(v){return v.starts_at==u.starts_at&&v.DayType=="RD"}),function(v,w){s.push(w)});if(s.length>0){$.each(s,function(v,w){k.mainEvent.push(w)})}}}})})}k.months=[{ID:1,Name:"January"},{ID:2,Name:"February"},{ID:3,Name:"March"},{ID:4,Name:"April"},{ID:5,Name:"May"},{ID:6,Name:"June"},{ID:7,Name:"July"},{ID:8,Name:"August"},{ID:9,Name:"September"},{ID:10,Name:"October"},{ID:11,Name:"November"},{ID:12,Name:"December"}];k.years=[];for(var f=0;f<41;f++){k.years.push({ID:(n-20)+f,Name:String((n-20)+f)})}};a.controller("cCalendar",["$scope","dataService","$modalInstance","$state",b]);var c=function(h,e,g,i,f){h.dataNotification=f.data;h.closeDg=function(){g.close()}};a.controller("cNotification",["$scope","dataService","$modalInstance","$state","data",c])});