angular.module("ui.calendar",[]).constant("uiCalendarConfig",{calendars:{}}).controller("uiCalendarCtrl",["$scope","$timeout","$locale",function(n,e,r){var a=1,t=1,o=n.eventSources,l=n.calendarWatchEvent?n.calendarWatchEvent:angular.noop,u=function(n){var r;return n&&(r=function(){var r=arguments,a=this;e(function(){n.apply(a,r)})}),r};this.eventsFingerprint=function(n){return n._id||(n._id=t++),""+n._id+(n.id||"")+(n.title||"")+(n.url||"")+(+n.start||"")+(+n.end||"")+(n.allDay||"")+(n.className||"")+l(n)||""},this.sourcesFingerprint=function(n){return n.__id||(n.__id=a++)},this.allEvents=function(){for(var n=[],e=0,r=o.length;r>e;e++){var a=o[e];if(angular.isArray(a))n.push(a);else if(angular.isObject(a)&&angular.isArray(a.events)){var t={};for(var l in a)"_uiCalId"!==l&&"events"!==l&&(t[l]=a[l]);for(var u=0;u<a.events.length;u++)angular.extend(a.events[u],t);n.push(a.events)}}return Array.prototype.concat.apply([],n)},this.changeWatcher=function(n,e){var r,a=function(){for(var r,a,t=angular.isFunction(n)?n():n,l=[],u=0,i=t.length;i>u;u++)a=t[u],r=e(a),o[r]=a,l.push(r);return l},t=function(n,e){var r,a,t=[],o={};for(r=0,a=e.length;a>r;r++)o[e[r]]=!0;for(r=0,a=n.length;a>r;r++)o[n[r]]||t.push(n[r]);return t},o={},l=function(n,a){var l,u,i,c,s={},d=t(a,n);for(l=0,u=d.length;u>l;l++){var f=d[l];i=o[f],delete o[f];var g=e(i);g===f?r.onRemoved(i):(s[g]=f,r.onChanged(i))}var v=t(n,a);for(l=0,u=v.length;u>l;l++)c=v[l],i=o[c],s[c]||r.onAdded(i)};return r={subscribe:function(n,e){n.$watch(a,function(n,r){e&&e(n,r)===!1||l(n,r)},!0)},onAdded:angular.noop,onChanged:angular.noop,onRemoved:angular.noop}},this.getFullCalendarConfig=function(n,e){var r={};return angular.extend(r,e),angular.extend(r,n),angular.forEach(r,function(n,e){"function"==typeof n&&(r[e]=u(r[e]))}),r},this.getLocaleConfig=function(n){if(!n.lang||n.useNgLocale){var e=function(n){var e,r;e=[];for(r in n)e[r]=n[r];return e},a=r.DATETIME_FORMATS;return{monthNames:e(a.MONTH),monthNamesShort:e(a.SHORTMONTH),dayNames:e(a.DAY),dayNamesShort:e(a.SHORTDAY)}}return{}}}]).directive("uiCalendar",["uiCalendarConfig",function(n){return{restrict:"A",scope:{eventSources:"=ngModel",calendarWatchEvent:"&"},controller:"uiCalendarCtrl",link:function(e,r,a,t){function o(){var r,o=a.uiCalendar?e.$parent.$eval(a.uiCalendar):{};r=t.getFullCalendarConfig(o,n);var l=t.getLocaleConfig(r);angular.extend(l,r),i={eventSources:u},angular.extend(i,l),i.calendars=null;var c={};for(var s in i)"eventSources"!==s&&(c[s]=i[s]);return JSON.stringify(c)}var l,u=e.eventSources,i=(t.changeWatcher(u,t.sourcesFingerprint),t.changeWatcher(t.allEvents,t.eventsFingerprint),null);e.destroy=function(){l&&l.fullCalendar&&l.fullCalendar("destroy"),l=a.calendar?n.calendars[a.calendar]=$(r).html(""):$(r).html("")},e.init=function(){l.fullCalendar(i)},e.$watch(o,function(){e.destroy(),e.init()})}}}]);