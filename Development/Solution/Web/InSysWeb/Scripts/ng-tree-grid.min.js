!function(){"use strict";angular.module("treeGrid",["tree.grid.cell"]).directive("treeGrid",["$timeout","$parse",function(e,n){return{restrict:"E",template:'<div><table class="table table-bordered table-striped tree-grid"><thead class="text-primary"><tr><th ng-style=\'{"width": treeDepth }\'>{{expandingProperty.displayName || expandingProperty.field}}</th><th sly-repeat="col in colDefinitions">{{col.displayName || col.field}}</th></tr></thead><tbody><tr ng-repeat="row in tree_rows | filter:{visible:true} track by row.entity.uid" ng-class="\'level-\' + {{ row.level }} + (row.entity.selected ? \' active\':\'\')" class="tree-grid-row"><td class="text-primary" ><a ng-click="user_clicks_branch(row.entity)"><i ng-class="row.tree_icon" ng-click="row.entity.expanded = !row.entity.expanded" class="indented tree-icon"></i></a><span class="indented tree-label"  tree-grid-cell=\'expandingProperty\'></span></td><td sly-repeat="col in colDefinitions" tree-grid-cell=\'col\' ></td></tr></tbody><table></div>',replace:!0,scope:!0,link:function(t,r,l){var i,a,c,u,o,d,s,f,h,p,_,g;i=function(e){return void console.log("ERROR:"+e)};var v=t.$eval(l.treeData);if(null==l.iconExpand&&(l.iconExpand="icon-plus  glyphicon glyphicon-plus  fa fa-plus"),null==l.iconCollapse&&(l.iconCollapse="icon-minus glyphicon glyphicon-minus fa fa-minus"),null==l.iconLeaf&&(l.iconLeaf="icon-file  glyphicon glyphicon-file  fa fa-file"),u=parseInt(null==v.expandLevel?2:v.expandLevel,10),t.treeData=t.$eval(v.data),t.treeData){if(null==t.treeData.length){if(null==treeData.label)return void console.log("treeData should be an array of root branches");t.treeData=[treeData]}var b=function(e){var n=0;return e.children&&e.children.forEach(function(e){var t=b(e);t>n&&(n=t)}),1+n};t.treeDepth=0;for(var x=0;$=t.treeData.length,$>x;x++){var y=b(t.treeData[x]);t.treeDepth<y&&(t.treeDepth=y)}t.treeDepth=30*t.treeDepth;var D=v.columnDefs;if(D)t.colDefinitions=D;else{var m=[],w=t.treeData[0],O=["children","level","expanded",a];for(var k in w)-1==O.indexOf(k)&&m.push({field:k});t.colDefinitions=m}if(v.expandOn)a=v.expandOn.field,t.expandingProperty=v.expandOn;else{for(var w=t.treeData[0],C=Object.keys(w),x=0,$=C.length;$>x;x++)if("string"==typeof w[C[x]]){a=C[x];break}a||(a=C[0]),t.expandingProperty=a}return d=function(e){var n,r,l,i,a,c;for(n=function(t,r){var l,i,a,c,u;if(e(t,r),null!=t.children){for(c=t.children,u=[],i=0,a=c.length;a>i;i++)l=c[i],u.push(n(l,r+1));return u}},a=t.treeData,c=[],l=0,i=a.length;i>l;l++)r=a[l],c.push(n(r,1));return c},_=null,p=function(r){if(!r)return null!=_&&(_.selected=!1),void(_=null);if(r!==_){if(null!=_&&(_.selected=!1),r.selected=!0,_=r,c(r),null!=r.onSelect)return e(function(){return r.onSelect(r)});null!=l.onSelect&&n(l.onSelect)(t.$parent,{branch:r})}},t.user_clicks_branch=function(e){return e!==_?p(e):void 0},s=function(e){var n;return n=void 0,e.parent_uid&&d(function(t){return t.uid===e.parent_uid?n=t:void 0}),n},o=function(e,n){var t;return t=s(e),null!=t?(n(t),o(t,n)):void 0},c=function(e){return o(e,function(e){return e.expanded=!0})},t.tree_rows=[],h=function(){var e,n,r,i,c,u;for(d(function(e){return e.uid?void 0:e.uid=""+Math.random()}),d(function(e){var n,t,r,l,i;if(angular.isArray(e.children)){for(l=e.children,i=[],t=0,r=l.length;r>t;t++)n=l[t],i.push(n.parent_uid=e.uid);return i}}),t.tree_rows=[],d(function(e){var n,t;return e.children?e.children.length>0?(t=function(e){return"string"==typeof e?{label:e,children:[]}:e},e.children=function(){var r,l,i,a;for(i=e.children,a=[],r=0,l=i.length;l>r;r++)n=i[r],a.push(t(n));return a}()):void 0:e.children=[]}),e=function(n,r,i){var c,u,o,d,s,f,h;if(null==r.expanded&&(r.expanded=!1),r.children&&0!==r.children.length&&(o=r.expanded?l.iconCollapse:l.iconExpand),r.level=n,t.tree_rows.push({level:n,entity:r,label:r[a],tree_icon:o,visible:i}),null!=r.children){for(f=r.children,h=[],d=0,s=f.length;s>d;d++)c=f[d],u=i&&r.expanded,h.push(e(n+1,c,u));return h}},c=t.treeData,u=[],r=0,i=c.length;i>r;r++)n=c[r],u.push(e(1,n,!0));return u},t.$watch("treeData",h,!0),null!=l.initialSelection&&d(function(n){return n.label===l.initialSelection?e(function(){return p(n)}):void 0}),f=t.treeData.length,d(function(e,n){return e.level=n,e.expanded=e.level<u}),null!=t.treeControl&&angular.isObject(t.treeControl)?(g=t.treeControl,g.expand_all=function(){return d(function(e){return e.expanded=!0})},g.collapse_all=function(){return d(function(e){return e.expanded=!1})},g.get_first_branch=function(){return f=t.treeData.length,f>0?t.treeData[0]:void 0},g.select_first_branch=function(){var e;return e=g.get_first_branch(),g.select_branch(e)},g.get_selected_branch=function(){return _},g.get_parent_branch=function(e){return s(e)},g.select_branch=function(e){return p(e),e},g.get_children=function(e){return e.children},g.select_parent_branch=function(e){var n;return null==e&&(e=g.get_selected_branch()),null!=e&&(n=g.get_parent_branch(e),null!=n)?(g.select_branch(n),n):void 0},g.add_branch=function(e,n){return null!=e?(e.children.push(n),e.expanded=!0):t.treeData.push(n),n},g.add_root_branch=function(e){return g.add_branch(null,e),e},g.expand_branch=function(e){return null==e&&(e=g.get_selected_branch()),null!=e?(e.expanded=!0,e):void 0},g.collapse_branch=function(e){return null==e&&(e=_),null!=e?(e.expanded=!1,e):void 0},g.get_siblings=function(e){var n,r;return null==e&&(e=_),null!=e?(n=g.get_parent_branch(e),r=n?n.children:t.treeData):void 0},g.get_next_sibling=function(e){var n,t;return null==e&&(e=_),null!=e&&(t=g.get_siblings(e),f=t.length,n=t.indexOf(e),f>n)?t[n+1]:void 0},g.get_prev_sibling=function(e){var n,t;return null==e&&(e=_),t=g.get_siblings(e),f=t.length,n=t.indexOf(e),n>0?t[n-1]:void 0},g.select_next_sibling=function(e){var n;return null==e&&(e=_),null!=e&&(n=g.get_next_sibling(e),null!=n)?g.select_branch(n):void 0},g.select_prev_sibling=function(e){var n;return null==e&&(e=_),null!=e&&(n=g.get_prev_sibling(e),null!=n)?g.select_branch(n):void 0},g.get_first_child=function(e){var n;return null==e&&(e=_),null!=e&&(null!=(n=e.children)?n.length:void 0)>0?e.children[0]:void 0},g.get_closest_ancestor_next_sibling=function(e){var n,t;return n=g.get_next_sibling(e),null!=n?n:(t=g.get_parent_branch(e),g.get_closest_ancestor_next_sibling(t))},g.get_next_branch=function(e){var n;return null==e&&(e=_),null!=e?(n=g.get_first_child(e),null!=n?n:n=g.get_closest_ancestor_next_sibling(e)):void 0},g.select_next_branch=function(e){var n;return null==e&&(e=_),null!=e&&(n=g.get_next_branch(e),null!=n)?(g.select_branch(n),n):void 0},g.last_descendant=function(e){var n;return f=e.children.length,0===f?e:(n=e.children[f-1],g.last_descendant(n))},g.get_prev_branch=function(e){var n,t;return null==e&&(e=_),null!=e?(t=g.get_prev_sibling(e),null!=t?g.last_descendant(t):n=g.get_parent_branch(e)):void 0},g.select_prev_branch=function(e){var n;return null==e&&(e=_),null!=e&&(n=g.get_prev_branch(e),null!=n)?(g.select_branch(n),n):void 0}):void 0}}}}]),angular.module("tree.grid.cell",[]).directive("treeGridCell",["$compile",function(e){return{scope:!1,compile:function(){return{pre:function(n,t,r){var l=n.$eval(r.treeGridCell),i=l.cellTemplate||"<span>{{row.entity."+l.field+"}}</span>",a=angular.element(i);t.append(a),e(a)(n)}}}}}])}(window,document);